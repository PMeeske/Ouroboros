name: Copilot Agent Solver

on:
  issues:
    types:
      # Trigger when an issue is labeled
      - labeled

permissions:
  # Required for the coding agent to create PRs
  pull-requests: write
  # Required to read contents of the repo and issue details
  contents: read
  issues: read

jobs:
  dispatch-copilot-agent:
    # Only run if the label added is 'copilot-agent'
    if: github.event.label.name == 'copilot-agent'
    runs-on: ubuntu-latest
    steps:
      # This is the official action to trigger the Copilot coding agent.
      # It replaces the broken github-script step.
      - name: Dispatch Copilot coding agent
        uses: github/copilot-action@v1
        env:
          # This action requires a token with write permissions for pull-requests and issues.
          # A PAT (Personal Access Token) is recommended.
          GITHUB_TOKEN: ${{ secrets.COPILOT_BOT_TOKEN }}
        with:
          # The action will use the title and body of this issue as the problem statement.
          issue-number: ${{ github.event.issue.number }}
