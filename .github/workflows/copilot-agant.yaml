name: Copilot Agent Task Processor

on:
  issues:
    types: [opened, labeled, edited]

permissions:
  issues: write
  contents: read

jobs:
  analyze:
    if: contains(github.event.issue.labels.*.name, 'copilot-agent')
    runs-on: ubuntu-latest
    steps:
      - name: Log task metadata
        run: |
          echo "Processing Copilot agent task: #${{ github.event.issue.number }}"
          echo "Title: ${{ github.event.issue.title }}"
          echo "Labels: ${{ toJson(github.event.issue.labels) }}"
      
      - name: Post agent analysis comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const body = `
ðŸ¤– **Copilot Agent Analysis**

Hello! I'm your Copilot Agent.
Iâ€™ve detected this automated task and will begin processing it.
Please wait while I analyze your request and prepare recommendations.  
*(This is an automated response triggered by label \`copilot-agent\`.)*
`;
            await github.rest.issues.createComment({
              issue_number: issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body
            });
